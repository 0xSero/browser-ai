import katex from"./katex.mjs";let inlineRule=/^(\${1,2})(?!\$)((?:\\.|[^\\\n])*?(?:\\.|[^\\\n\$]))\1(?=[\s?!\.,:？！。，：]|$)/,inlineRuleNonStandard=/^(\${1,2})(?!\$)((?:\\.|[^\\\n])*?(?:\\.|[^\\\n\$]))\1/,blockRule=/^(\${1,2})\n((?:\\[^]|[^\\])+?)\n\1(?:\n|$)/;export default function(e={}){return{extensions:[inlineKatex(e,createRenderer(e,!1)),blockKatex(e,createRenderer(e,!0))]}}function createRenderer(n,t){return e=>katex.renderToString(e.text,{...n,displayMode:e.displayMode})+(t?"\n":"")}function inlineKatex(e,n){let i=e&&e.nonStandard,a=i?inlineRuleNonStandard:inlineRule;return{name:"inlineKatex",level:"inline",start(e){var n;let t=e;for(;t;){if(-1===(n=t.indexOf("$")))return;var r=i?-1<n:0===n||" "===t.charAt(n-1);if(r)if(t.substring(n).match(a))return n;t=t.substring(n+1).replace(/^\$+/,"")}},tokenizer(e,n){e=e.match(a);if(e)return{type:"inlineKatex",raw:e[0],text:e[2].trim(),displayMode:2===e[1].length}},renderer:n}}function blockKatex(e,n){return{name:"blockKatex",level:"block",tokenizer(e,n){e=e.match(blockRule);if(e)return{type:"blockKatex",raw:e[0],text:e[2].trim(),displayMode:2===e[1].length}},renderer:n}}