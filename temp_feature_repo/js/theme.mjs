let browser="undefined"!=typeof chrome?chrome:browser;class ThemeManager{static instance;static STORAGE_KEY="theme";constructor(){if(ThemeManager.instance)return ThemeManager.instance;(ThemeManager.instance=this).currentTheme=null,this.darkMedia=window.matchMedia("(prefers-color-scheme: dark)"),this.initPromise=this.initialize()}async initialize(){var t=this;await browser.storage.local.get(ThemeManager.STORAGE_KEY,function(e){t.currentTheme=e.theme,t.applyTheme(t.getActiveTheme()),t.updateUI(t.getActiveTheme()),t.setupListeners()})}switchGitHubMarkdownTheme(e){var t=document.querySelector('link[href*="github-markdown-dark.css"]')||document.querySelector('link[href*="github-markdown-light.css"]');t&&t.href!==(e="dark"===e?"/css/github-markdown-dark.css":"/css/github-markdown-light.css")&&(t.href=e)}getActiveTheme(){return this.currentTheme??(this.darkMedia.matches?"dark":"light")}applyTheme(e){var t="auto"===e?this.darkMedia.matches?"dark":"light":e;document.documentElement.setAttribute("data-bs-theme",t),this.switchGitHubMarkdownTheme(e)}async setTheme(e){await browser.storage.local.set({[ThemeManager.STORAGE_KEY]:e}),this.currentTheme=e,this.applyTheme(e),this.updateUI(e)}updateUI(a,e=!1){var t=document.querySelector("#bd-theme");t&&(document.querySelectorAll("[data-bs-theme-value]").forEach(e=>{var t=e.dataset.bsThemeValue===a;e.classList.toggle("active",t),e.setAttribute("aria-pressed",t),t&&(t=e.querySelector("svg use")?.getAttribute("href"))&&document.querySelector(".theme-icon-active use")?.setAttribute("href",t)}),t.setAttribute("aria-label",`Toggle theme (${a})`),e)&&t.focus()}setupListeners(){this.darkMedia.addEventListener("change",()=>{"auto"!==this.currentTheme&&null!==this.currentTheme||this.applyTheme(this.getActiveTheme())}),document.body.addEventListener("click",async e=>{e=e.target.closest("[data-bs-theme-value]");e&&await this.setTheme(e.dataset.bsThemeValue)})}}export{ThemeManager};