let TextProcessor={renderTemplate(e,r){return"string"==typeof e&&r?e.replace(/\${(.*?)}/g,(e,t)=>t.split(".").reduce((e,t)=>(e||{})[t.trim()],r)||""):e},estimateTokens(e){var t,r;return e?(t=e.match(/[\u4e00-\u9fa5]/g)||[],r=e.split(/[\s\n]+/).filter(e=>e),e=e.match(/[^\p{L}\s]/gu)||[],t=1.3*t.length,r=1.3*r.length,e=.7*e.length,Math.ceil(1.1*(t+r+e))):0},normalizeWhitespace(e){return"string"!=typeof e?"":e.replace(/\r\n?|\n/g," ").replace(/\s+/g," ").replace(/^ | $/g,"").trim()},truncateToTokens(e,r){if("string"!=typeof e||r<=0)return"";var s=this.normalizeWhitespace(e);if(this.estimateTokens(s)<=r)return s;var t;let i="";for(t of s.split(/([。！？?！.](?=\s|$))/g).reduce((e,t,r)=>(r%2==0?e.push(t):e[e.length-1]+=t,e),[])){var a=i+t;if(this.estimateTokens(a)>r)break;i=a}if(!i){let e=0,t=s.length;for(;e<=t;){var n=e+t>>>1,l=s.slice(0,n);this.estimateTokens(l)<=r?(i=l,e=1+n):t=n-1}}for(var o,c;i&&this.estimateTokens(i)>r;)i=(o=i,c=void 0,0<(c=Math.max(o.lastIndexOf(" "),o.lastIndexOf("。"),o.lastIndexOf("!"),o.lastIndexOf("?")))?o.slice(0,c+1):o.slice(0,-1));return i||s.slice(0,10)}};export{TextProcessor};